<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Custom HTTP headers </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Custom HTTP headers ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../guidetoc/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <strong>i2 Connect gateway</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="custom-http-headers">Custom HTTP headers</h1>

<p>Starting at version 4.3.3, i2 Analyze contains an extension point that enables you to return additional headers to any connectors from the i2 Connect gateway. The extension point requires you to write an implementation of <code>IConnectorRequestModifier.java</code>. The implementation must be packaged into a JAR file and deployed to i2 Analyze. The following example demonstrates how to use Maven to do this and how to configure i2 Analyze to use your implementation.</p>
<h2 id="overview">Overview</h2>
<p>For i2 Analyze to use your implementation, complete the following tasks:</p>
<ol>
<li>Create and package your implementation of <code>IConnectorRequestModifier.java</code></li>
<li>Configure i2 Analyze to use your packaged implementation</li>
<li>Redeploy and restart Liberty to update your deployment</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Java installed</li>
</ul>
<h2 id="the-principal-propagation-project">The principal propagation project</h2>
<p>Update the value of the <code>&lt;toolkitLocation&gt;</code> element in the <code>principal-propagation/pom.xml</code> file to reference the installation location of i2 Analyze. For example:</p>
<pre><code class="lang-xml">&lt;toolkitLocation&gt;C:\i2\i2analyze&lt;/toolkitLocation&gt;
</code></pre><p>This location is used by Maven to locate the JAR files to pull into the local Maven repository and where to place the packaged JAR file that contains your implementation.</p>
<p>To set up the Maven environment, open a terminal in the <code>principal-propagation</code> directory.</p>
<h3 id="1-initialize-the-maven-dependencies">1. Initialize the Maven dependencies:</h3>
<pre><code class="lang-shell">mvnw initialize
</code></pre><p>This pulls in JAR files from the i2 Analyze deployment toolkit into your local Maven repository.</p>
<h3 id="2-compile-and-install-the-project">2. Compile and install the project:</h3>
<pre><code class="lang-shell">mvnw clean install
</code></pre><p>At this point, you could start editing the implementation in <code>principal-propagation/src/main/java/com/i2group/example/PrincipalPropagation.java</code>. For the example implementation, do not make any changes.</p>
<h2 id="deploy-the-principal-propagation-implementation">Deploy the principal propagation implementation</h2>
<p>When the implementation is complete, package the class into a JAR file.</p>
<p>Open a terminal in the <code>principal-propagation</code> directory and run the following command:</p>
<pre><code class="lang-shell">mvnw package
</code></pre><p>The Maven <code>package</code> command creates a JAR file from the <code>PrincipalPropagation.java</code> class and puts it in the <code>toolkit/configuration/fragments/opal-services/WEB-INF/lib/</code> directory of the i2 Analyze toolkit specified in the <code>&lt;toolkitLocation&gt;</code> element.</p>
<h2 id="configuring-i2-analyze">Configuring i2 Analyze</h2>
<p>For i2 Analyze to use the <code>PrincipalPropagation.jar</code>, it must be specified in the <code>DiscoServerSettingsCommon.properties</code> file.</p>
<p>Add the following line to the end of the <code>toolkit/configuration/fragments/opal-services/WEB-INF/classes/DiscoServerSettingsCommon.properties</code> file:</p>
<pre><code class="lang-properties">ConnectorRequestModifier=com.i2group.example.PrincipalPropagation
</code></pre><h2 id="redeploy-and-restart-liberty">Redeploy and restart Liberty</h2>
<pre><code class="lang-shell">setup -t stopLiberty
setup -t deployLiberty
setup -t startLiberty
</code></pre><p>Any connectors receive an extra header named <code>i2ExtensionHeader</code> in responses from the i2 Connect gateway.</p>
<p>For example:</p>
<pre><code class="lang-http">Host: localhost:9084,
Connection: keep-alive,
Content-Length: 92,
User-Agent: Apache-HttpClient/4.5.6 (Java/1.8.0_232)
Content-Type: application/json
i2ExtensionHeader: Jenny
Accept-Encoding: gzip,deflate
Accept-Language: en-gb
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation (2022).
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
