<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Seeded search </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Seeded search ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../guidetoc/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <strong>i2 Connect gateway</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="seeded-search">Seeded search</h1>

<p>A seeded search passes information from an entity on the chart to the connector so that you can use that information to drive your searches. In order to pass an entity as a seed, users can select an entity in Analyst&#39;s Notebook Premium and open &quot;External Search&quot;.</p>
<p>Again, if you face any issues during this task, remember to consult the <a href="../miscellaneous/troubleshoot.html">troubleshooting guide</a>.</p>
<p>For more information on seeded queries, see <a href="../workflow/seeds.html">Supporting seeds</a>.</p>
<h2 id="configuration">Configuration</h2>
<p>You need to configure a service to allow for seeded searches.</p>
<h3 id="add-a-new-service">Add a new service</h3>
<p>Add two new services for seeded searches to the services array in the <code>config.json</code> file.
The services should also define the <code>seedConstraints</code> object that controls the entities that are allowed by the seeded search.</p>
<pre><code class="lang-json">{
  &quot;services&quot;: [
    {
      &quot;id&quot;: &quot;nypd-find-like-this-complaint-service&quot;,
      &quot;name&quot;: &quot;NYPD Connector: Find like this complaint&quot;,
      &quot;description&quot;: &quot;A service that finds a similar complaint.&quot;,
      &quot;acquireUrl&quot;: &quot;/find-like-this-complaint&quot;,
      &quot;seedConstraints&quot;: {
        &quot;min&quot;: 1,
        &quot;max&quot;: 1,
        &quot;seedTypes&quot;: {
          &quot;allowedTypes&quot;: &quot;ENTITY&quot;,
          &quot;itemTypes&quot;: [
            {
              &quot;id&quot;: &quot;made-up-schema-type-id (e.g. ET1)&quot;,
              &quot;min&quot;: 1,
              &quot;max&quot;: 1
            }
          ]
        }
      }
    },
    {
      &quot;id&quot;: &quot;nypd-expand-service&quot;,
      &quot;name&quot;: &quot;NYPD Connector: Expand&quot;,
      &quot;description&quot;: &quot;A service that executes an expand operation on a seed.&quot;,
      &quot;acquireUrl&quot;: &quot;/expand&quot;,
      &quot;seedConstraints&quot;: {
        &quot;min&quot;: 1,
        &quot;max&quot;: 1,
        &quot;seedTypes&quot;: {
          &quot;allowedTypes&quot;: &quot;ENTITY&quot;,
          &quot;itemTypes&quot;: [
            {
              &quot;id&quot;: &quot;made-up-schema-type-id (e.g. ET1)&quot;
            },
            {
              &quot;id&quot;: &quot;made-up-schema-type-id (e.g. ET1)&quot;
            }
          ]
        }
      }
    }
  ]
}
</code></pre><p>We will cover these two types of seeded queries later in this topic.
For now, update the <code>id</code>s of the <code>itemTypes</code> to values that exist in your schema.</p>
<h3 id="check-service-in-analysts-notebook-premium">Check service in Analyst&#39;s Notebook Premium</h3>
<p>Reload the connector and check that your services are in the list of defined services in Analyst&#39;s Notebook Premium.</p>
<ol>
<li><p>Open a web browser and navigate to <code>&lt;i2-Analyze-URL&gt;/admin#/connectors</code>, where <code>&lt;i2-Analyze-URL&gt;</code> is the URL used to access your i2 Analyze deployment.
For example, <code>http://localhost:9082/opaldaod/admin#/connectors</code>.</p>
<p><strong>Note:</strong> For more information about the Admin Console, refer to <a href="https://docs.i2group.com/analyze/admin-cac.html">i2 Analyze Server Admin Console</a>.</p>
</li>
<li><p>If you are prompted to log in, enter the credentials for your default user.
If you added an example user, the username and the password will be <code>Jenny</code>.</p>
</li>
<li><p>Click <strong>Reload gateway</strong> to enact your changes.</p>
</li>
<li><p>Log out and log back in to Analyst&#39;s Notebook Premium to see the configuration changes and your newly defined service.  </p>
</li>
<li><p>You may notice that you are not able to run any of the new services.
Since they are seeded services, you must first select a valid seed.
Run one of the valid services defined in previous topics and copy the entities to the chart.</p>
</li>
<li><p>Select one of the entities.
If the entity type matches the valid seed type defined by the seeded service, that service will become available to execute.</p>
</li>
<li><p>Run the seeded service.</p>
</li>
</ol>
<p>You should receive an error as your seeded search has been defined but not yet implemented.</p>
<h2 id="implementation">Implementation</h2>
<p>It&#39;s time to implement the service.</p>
<h3 id="add-an-acquire-endpoint-for-your-service">Add an acquire endpoint for your service</h3>
<h4 id="java">Java</h4>
<p>i2 Analyze knows the acquire URL for this service. Now you need to add the corresponding endpoint in the connector.</p>
<p>Define the seeded search endpoint in the <code>ConnectorController</code> class as below:</p>
<pre><code class="lang-java">/**
  * Defines the seeded search endpoint which acquires the seeded search data (entities and links
  * based on seeds)
  *
  * @param request The request containing the payload.
  * @return The resulting entities and links connected to the selected entities.
  */
@RequestMapping(
      method = RequestMethod.POST,
      value = &quot;SEEDED SEARCH ACQUIRE URL GOES HERE&quot;,
      consumes = APPLICATION_JSON_VALUE,
      produces = APPLICATION_JSON_VALUE)
public ConnectorResponse testSeededSearchService(@Valid @RequestBody ConnectorRequest request) {
  // TODO: Extract seed information and use it to search
  System.out.println(request.payload.seeds);
  return connectorDataService.retrieveTestDataFromExternalSource(/*seeds*/ );
}
</code></pre><p>You must update the <code>value</code> field in the <code>@RequestMapping</code> object with the <code>acquireUrl</code> defined by your seeded service in <code>config.json</code>.</p>
<h4 id="python">Python</h4>
<p>i2 Analyze knows the acquire URL for this service. Now you need to add the corresponding endpoint in the connector.</p>
<p>Define the seeded search endpoint in the <code>controller.py</code> class, as below:</p>
<pre><code class="lang-python">@controller.route(&#39;SEEDED SEARCH ACQUIRE URL GOES HERE&#39;, methods=[&#39;POST&#39;])
def seeded_search():
    &quot;&quot;&quot;
    Defines the seeded search endpoint which acquires the
    seeded search data (entities and links based on conditions)
    &quot;&quot;&quot;
    print(request.json[&#39;payload&#39;][&#39;seeds&#39;])

    # TODO: Extract seeded information and use it to search

    return query_external_datasource()
</code></pre><p>You must update the <code>@controller.route</code> value with the <code>acquireUrl</code> defined by your seeded service in <code>config.json</code>.</p>
<h3 id="access-seeds">Access seeds</h3>
<p>You will need to manipulate a seed passed into the request according to the <a href="https://i2group.github.io/analyze-connect/content/rest/i2-connect-spi.html">SPI</a>, and return a response containing entities and links.</p>
<h3 id="filter-data-based-on-seed">Filter data based on seed</h3>
<p>How you will use the seed depends on what you are trying to achieve.</p>
<h4 id="find-like-this-seeded-search">Find Like This seeded search</h4>
<ul>
<li>A <code>Find Like This</code> query looks at the property values of a selected record and searches for data in the external source that has the same or similar property values.</li>
<li>For this service you will need to filter out your entities based on the matching properties of the seed entity that can be accessed via <code>request.payload.seeds.entities.get(0)</code>.</li>
<li><strong>Note:</strong> Do not return the entity that was passed as the <code>seed</code>.</li>
</ul>
<h4 id="expand-seeded-search">Expand seeded search</h4>
<ul>
<li>An <code>Expand</code> query takes an entity as a seed and returns a list of entities and links that are connected to the seed.</li>
<li>For this service you will need to find <em>all links</em> connected to the seed entity that can be accessed via <code>request.payload.seeds.entities.get(0)</code>. Then you will need to find <em>all entities</em> connected to these links.</li>
<li>Finally, you need to make sure that the link is pointing to the <code>seedId</code>.</li>
<li>To do that, you will need to change <code>toEndId</code> or <code>fromEndId</code> to the <code>seedId</code> that can be accessed via <code>request.payload.seeds.entities.get(0).sourceIds.get(0).key.get(2)</code>.</li>
</ul>
<p>For more information about these and other uses for seeded searches, see <a href="../workflow/seeds.html">Supporting seeds</a>.</p>
<h2 id="run-your-query">Run your query</h2>
<p>Run the seeded search service in Analyst&#39;s Notebook Premium.</p>
<ol>
<li><p>Redeploy the connector. Depending on how you are running the connector, this may be done automatically for you when changes are made.</p>
</li>
<li><p>Open Analyst&#39;s Notebook Premium.</p>
</li>
<li><p>Select an entity on the chart.</p>
</li>
<li><p>Click &quot;External Search&quot;.</p>
</li>
<li><p>Click your seeded search service to run it.</p>
</li>
</ol>
<p>You should now see a list of result entities that are connected to the entity you initially selected.</p>
<h2 id="next-steps">Next steps</h2>
<p>Next, you can combine what you&#39;ve learned from these past two sections to implement <a href="8-seeded-parameterised-search.html">seeded parameterized searches</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation.
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
