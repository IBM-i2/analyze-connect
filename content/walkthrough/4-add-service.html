<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Adding a service </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Adding a service ">
    <meta name="generator" content="docfx 2.56.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../guidetoc/toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                IBM <strong>i2 Connect gateway</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="adding-a-service">Adding a service</h1>

<p>In this task, you add a simple service with the minimum configuration required
for your connector to be valid. For the moment, the service returns to i2
Analyze some dummy data that you create. Later on, it will retrieve real data
from the NYPD Complaint Dataset.</p>
<p>Remember to consult the <a href="../miscellaneous/troubleshoot.html">troubleshooting guide</a> if you face
any issues.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before starting, ensure that you have:</p>
<ul>
<li><a href="2-deploy-i2-analyze.html">Deployed i2 Analyze with the i2 Connect gateway</a></li>
<li><a href="3-deploy-connector.html">Configured a basic connector</a></li>
</ul>
<h2 id="define-the-service">Define the service</h2>
<p>To make i2 Analyze aware that your service exists, you must define it in the
connector configuration returned by the config endpoint. This means editing the
<code>config.json</code> file in the <code>resources</code> directory.</p>
<h3 id="add-a-services-array">Add a services array</h3>
<p>At the top level of the configuration, add a services array:</p>
<pre><code class="lang-json">{
  &quot;defaultValues&quot;: {
     &quot;timeZoneId&quot;: &quot;Europe/London&quot;,
     &quot;resultIdsPersistent&quot;: true
  },
  &quot;services&quot;: []
}
</code></pre><h3 id="add-a-service">Add a service</h3>
<p>In the services array, define a service object. The mandatory fields to provide are the following.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>id</strong></td>
<td>The unique identifier of the service</td>
</tr>
<tr>
<td><strong>name</strong></td>
<td>The name of the service</td>
</tr>
<tr>
<td><strong>acquireUrl</strong></td>
<td>This specifies the URL for i2 Analyze to use to get data synchronously from the service. If this is present, then <strong>async</strong> must not be present. For more information about the <strong>async</strong> option, see <a href="../example-connectors/connector-async.html">Async Connector</a>.</td>
</tr>
<tr>
<td><strong>clientConfigType</strong></td>
<td>This specifies the type of interface a user will interact with when using the service, and takes one of the three following values: <ul><li><code>NONE</code> - there is no interface required, the service simply runs and returns whatever data it retrieves</li><li><code>FORM</code> - the user fills in a form to provide the service with extra information that it needs to run. This is used to provide text-search services, for example. </li><li><code>CUSTOM</code> - specifies that a custom client configuration will be used</li></ul>In the case of <code>FORM</code> and <code>CUSTOM</code> client configurations, the specific configuration to be used must be specified by the additional field <code>clientConfigId</code> and there must be a client configuration with the given ID defined in the connector configuration. This will be covered later.</td>
</tr>
</tbody>
</table>
<p>   It is also common and recommended to add a <code>description</code> field. This appears
   to users in Analyst&#39;s Notebook Premium, so can be used to give more information about
   what the service does. You should have something like the following.</p>
<pre><code class="lang-json">{
  &quot;defaultValues&quot;: {
     &quot;timeZoneId&quot;: &quot;Europe/London&quot;,
     &quot;resultIdsPersistent&quot;: true
  },
  &quot;services&quot;: [
     {
       &quot;id&quot;: &quot;nypd-service&quot;,
       &quot;name&quot;: &quot;NYPD Connector: Get All&quot;,
       &quot;description&quot;: &quot;A service which retrieves all data&quot;,
       &quot;clientConfigType&quot;: &quot;NONE&quot;,
       &quot;acquireUrl&quot;: &quot;/all&quot;
     }
  ]
}
</code></pre><h3 id="update-the-connectors-configuration">Update the connector&#39;s configuration</h3>
<p>To tell i2 Analyze to pick up these changes, you need to tell i2 Analyze to reload it&#39;s
connectors&#39; configurations, run:</p>
<ul>
<li><code>setup -t updateConnectorsConfiguration</code></li>
</ul>
<p>Use Postman to run the <code>Reload</code> request (running the <code>Form Based Login</code> request if
you have not already), which will configure your changes to the topology.</p>
<p>If this does not add the relevant changes to Analyst&#39;s Notebook, redeploy:</p>
<ol>
<li><code>setup -t stop</code></li>
<li><code>setup -t deploy</code></li>
<li><code>setup -t start</code></li>
</ol>
<h3 id="view-the-service-in-analysts-notebook-premium">View the service in Analyst&#39;s Notebook Premium</h3>
<p>Now that you have defined a service, you can try to use it.</p>
<ol>
<li>Open Analyst&#39;s Notebook Premium and login to the i2 Analyze server. If you
were already logged in, log out and then back in again.</li>
<li>Open External Searches. The service you have defined should appear.</li>
<li>Try to run it. Although the service is defined, since it has not yet been
implemented, you should see a red banner appear with the message &quot;Failed to
open the selected query. Contact your system administrator‬.&quot;</li>
<li>To see the full error, look in the <code>IBM_i2_Analysis_Repository.log</code> found
in <code>deploy\wlp\usr\servers\opal-server\logs\opal-services</code> within the
<code>i2analyze</code> directory. You should see a 404 (Page Not Found) Error. This is
because an endpoint for the <code>acquireUrl</code> defined in the <code>config.json</code> has
not been implemented.</li>
</ol>
<h2 id="implement-the-service">Implement the service</h2>
<p>Now that i2 Analyze knows to expect the service, you had better create it.</p>
<h3 id="look-at-the-spi">Look at the SPI</h3>
<p>The SPI you need to implement is documented in the
<a href="https://www.ibm.com/docs/en/i2-analyze/latest?topic=sources-i2-connect-gateway-rest-spi-reference">IBM Documentation</a>.
Think about the relevant objects you will need to implement in order to build
a service that returns a fixed set of entities and links that you will create.</p>
<h3 id="add-an-acquire-endpoint">Add an acquire endpoint</h3>
<p>i2 Analyze knows the acquire URL for this service. Now you need to add an
endpoint for it in the connector.</p>
<h4 id="java">Java</h4>
<ol>
<li><p>A template has been provided to get started with; see the <code>stage2/nypd-connector</code>
directory. This includes:</p>
<ul>
<li><p>an example configuration <code>config.json</code> with a service defined</p>
</li>
<li><p>some changes to <code>ConnectorController</code></p>
</li>
<li><p>a new class <code>ConnectorDataService</code></p>
</li>
<li><p>some REST transport classes.</p>
</li>
</ul>
</li>
<li><p>Apply these changes to your code, either manually, or by copying the files
over directly. You may need to change the path of the new method in
<code>ConnectorController</code> to match the acquireUrl of your service. You need not
copy the example <code>config.json</code> if you have defined your service correctly.
You can also just use the directory provided as it is setup to be used straight
away.</p>
</li>
<li><p>Look at how the endpoint is defined in the <code>ConnectorController</code> class and
the code that produces the response that is returned to i2 Analyze.</p>
</li>
</ol>
<h4 id="nodejs">Node.js</h4>
<ol>
<li><p>A template has been provided to get started with; see the <code>stage2/nypd-connector</code>
directory. This includes:</p>
<ul>
<li><p>an example configuration <code>config.json</code> with a service defined</p>
</li>
<li><p>a new acquire route in <code>app.js</code></p>
</li>
<li><p>a new acquire route with a <code>/test</code> endpoint in the <code>routes</code> folder</p>
</li>
<li><p>a new file <code>/helpers/data-service.js</code> containing functions for acquiring data</p>
</li>
</ul>
</li>
<li><p>Open the code from the <code>stage2/nypd-connector</code> in VSCode, or any IDE of your choice,
and start the connector.</p>
</li>
</ol>
<h4 id="python">Python</h4>
<ol>
<li><p>A template has been provided to get started with; see the <code>stage2/nypd-connector</code>
directory. This includes:</p>
<ul>
<li><p>an example configuration <code>config.json</code> with a service defined</p>
</li>
<li><p>some additions to <code>controller.py</code></p>
</li>
<li><p>a new file for service functions, <code>service.py</code></p>
</li>
<li><p>a new file <code>classes.py</code> containing some REST transport classes.</p>
</li>
</ul>
</li>
<li><p>Apply these changes to your code, either manually, or by copying the files
over directly. You may need to change the path of the new method in
<code>controller.py</code> to match the acquireUrl of your service. You need not
copy the example <code>config.json</code> if you have defined your service correctly.
You can also just use the directory provided as it is setup to be used straight
away.</p>
</li>
<li><p>Look at how the endpoint is defined in the <code>controller.py</code> class and
the code that produces the response that is returned to i2 Analyze.</p>
</li>
</ol>
<h3 id="test-the-service-in-analysts-notebook-premium">Test the service in Analyst&#39;s Notebook Premium</h3>
<ol>
<li>Redeploy the connector. Depending on how you are running the connector, this
may be done automatically for you when changes are made.</li>
<li>Re-run the service in  Analyst&#39;s Notebook Premium via the External Searches
window.</li>
<li>You should no longer get a 404 Error, but the search will return nothing</li>
</ol>
<h3 id="return-some-data">Return some data</h3>
<h4 id="java-1">Java</h4>
<ol>
<li><p>Make changes so that the service returns some entities and links - just
create some dummy data for now. You will need to complete the implementation
of the <code>LinkData</code> class provided.</p>
</li>
<li><p>Test your changes in Analyst&#39;s Notebook in the same way.</p>
</li>
<li><p>If you don&#39;t see what you expect to, or you come across an error,
investigate the <code>IBM_i2_Analysis_Repository.log</code> in the <code>deploy\wlp\usr\servers\opal-server\logs\opal-services</code> directory.</p>
</li>
</ol>
<h4 id="nodejs-1">Node.js</h4>
<ol>
<li><p>Make changes so that the service returns some entities and links - just
create some dummy data for now.</p>
</li>
<li><p>Test your changes in Analyst&#39;s Notebook in the same way.</p>
</li>
<li><p>If you don&#39;t see what you expect to, or you come across an error,
investigate the <code>IBM_i2_Analysis_Repository.log</code> in the <code>deploy\wlp\usr\servers\opal-server\logs\opal-services</code> directory.</p>
</li>
</ol>
<h4 id="python-1">Python</h4>
<ol>
<li><p>Make changes so that the service returns some entities and links - just
create some dummy data for now. You will need to complete the implementation
of the <code>Link</code> class in <code>classes.py</code>. Ensure you are importing the classes into <code>service.py</code>.</p>
</li>
<li><p>Test your changes in Analyst&#39;s Notebook in the same way.</p>
</li>
<li><p>If you don&#39;t see what you expect to, or you come across an error,
investigate the <code>IBM_i2_Analysis_Repository.log</code> in the <code>deploy\wlp\usr\servers\opal-server\logs\opal-services</code> directory.</p>
</li>
</ol>
<p>It is vital that you return property values
in the format expected, which is defined by the logical type of each property.
See the <a href="../miscellaneous/data-model.html">data model examples</a> for examples of each supported
logical type.</p>
<h2 id="querying-data-from-an-external-source">Querying data from an external source</h2>
<p>Now that you have a basic connector with a working simple service, you can make
it more useful by <a href="5-connect-to-eds.html">returning real data</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; Copyright IBM Corporation 2021.
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
